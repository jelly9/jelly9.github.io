<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>文件time的意义 | 果冻</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">文件time的意义</h1><a id="logo" href="/.">果冻</a><p class="description">想的太多，做的太少。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">文件time的意义</h1><div class="post-meta">Aug 26, 2017</div><div class="post-content"><p>在linux下每个文件（目录）都会记录很多时间参数，主要有三个关于文件变动的时间——<strong>mtime、atime、ctime</strong>，它们储存与<code>inode</code>“<strong>数据结构</strong>”中，使用<code>stat filename</code>命令可以查看它们。如下图所示（Access、Modify、Change）：<a id="more"></a><br><img src="http://i.imgur.com/WUG3OTV.png" alt=""></p>
<h1 id="1-ctime"><a href="#1-ctime" class="headerlink" title="1. ctime"></a>1. ctime</h1><p>change time：当文件（目录）的“状态”被改变时，这个时间会被更新，如文件的权限、拥有者、所属组属性、大小等。<br>如下：<br><img src="http://i.imgur.com/qluNOPQ.png" alt=""></p>
<h1 id="2-mtime"><a href="#2-mtime" class="headerlink" title="2. mtime"></a>2. mtime</h1><p>modification time:当文件（目录）的“<strong>内容数据</strong>”被修改时，这个时间会更新，权限的修改不会影响该时间。<br><strong>注意</strong>：对于目录来讲，它的内容是该目录路径下的文件（目录）名列表，这也就意味着，当你在某个目录下创建新的文件（目录）时，该目录的<code>mtime</code>会改变。<br>如下：<br><img src="http://i.imgur.com/Rj2PF8r.png" alt=""></p>
<p>细心的小伙伴可能会发现，我们只改变了文件的内容，但是文件的<code>ctime</code>也改变了，这是因为当改变了文件内容后，文件的大小属性也改变了，于是<code>ctime</code>也会随之改变。</p>
<p>#<strong>3. atime</strong><br>access time：获取时间，即当文件的“内容被访问读取”时，这个时间会被更新，比如<code>cat</code>某文件时，该文件的<code>atime</code>会改变。<br>不过这是一个有争议的时间参数，在某些Linux版本，当你使用cat、more读取文件内容后，<code>atime</code>并不会更新，为什么呢？</p>
<p>##1. <code>atime</code>未更新原因<br>想想你平常在使用Linux时使用比较频繁的命令是什么，我想<code>ls</code>和<code>cat</code>使用的应该很频繁了吧。那么当你每<code>ls</code>一次，文件的<code>atime</code>都会更新一次，除此之外，系统本身还有大量的文件访问，这些访问造成的<code>atime</code>更新如果都被写入到磁盘中，这样做会带来几个问题：</p>
<ol>
<li>大量的文件访问，会导致频繁的将<code>atime</code>写入磁盘，浪费时间，降低系统的性能。</li>
<li>这样做本身也是特别费电。</li>
</ol>
<p>说道这儿有人可能会问，为什么<code>ctime</code>、<code>mtime</code>为什么会即时更新呢？<br>原因是，在Linux系统中，我们往往最关心的是文件的修改时间，比如有人告诉你上周五完成的一个程序有个小bug，于是你就通过<code>mtime</code>或者是<code>ctime</code>定位找到上周五修改过的文件，你当然不会通过<code>atime</code>去找了，因为你可能昨天还<code>ls</code>过它。<br>所以，每次读取文件后更新它的<code>atime</code>好像并没有这个必要，一是我们平常并不会经常使用这个时间参数，二是频繁的更新它会导致系统的性能的损耗。于是Linux内核的开发人员为了提高性能，在<code>2.6.30</code>版本之后，修改了<code>atime</code>的更新机制。我查看了自己的版本，果然：<br><img src="http://i.imgur.com/eG5UHXO.png" alt=""></p>
<p>##2. <code>atime</code>会更新的情况<br>那么在<code>2.6.30</code>之后的版本，只有在下列几种情况下，才会更<code>atime</code>：</p>
<ol>
<li><code>atime</code>小于<code>ctime</code>或<code>mtime</code>时。举个例子：某文件的<code>atime</code>是<code>11:02</code>，而<code>mtime</code>是同一天的<code>12:03</code>，那么，当你<code>cat</code>改文件后，它的<code>atime</code>会更新。<br><code>atime</code>大于<code>ctime</code>的情况：<br><img src="http://i.imgur.com/mBU5NK1.png" alt=""></li>
</ol>
<p><code>atime</code>小于<code>ctime</code>的情况：<br><img src="http://i.imgur.com/XE9X4rF.png" alt=""> </p>
<ol>
<li>当前读取时间与上次间隔大于24小时。</li>
<li>如果将分区mount的挂载的时候指定采用非relatime方式(默认采用relatime方式)，如strictatime.<br>补充：在OS启动的时候，将各个分区挂载到不同的目录，在挂载(mount)的参数中采用strictatime，表明及时更新atime。在2.6.30之后mount添加了”relatime”和”strictatime”两个选项，详细的可以通过”man mount”查看。<br>##3. 如何让你的<code>atime</code>即时更新<br>那么如果你想让你的Linux文件的<code>atime</code>及时更新，要怎么做呢？<br>OS启动的时候会读取/etc/fstab文件，在你的Linux中修改<code>etc/fstab</code>文件，添加<code>strictatime</code>选项：<br><img src="http://i.imgur.com/7ADNBpY.png" alt=""></li>
</ol>
<p>然后重启你的OS，再去试试，是不是只要读取文件内容，它的<code>atime</code>就会改变呢!</p>
<p>#参考资料</p>
<ol>
<li><a href="http://stackoverflow.com/questions/15547649/is-it-necessary-to-enable-atime-in-etc-fstab-to-get-the-correct-last-accessed" target="_blank" rel="external">http://stackoverflow.com/questions/15547649/is-it-necessary-to-enable-atime-in-etc-fstab-to-get-the-correct-last-accessed</a></li>
<li><a href="http://www.h-online.com/open/news/item/Kernel-Log-What-s-coming-in-2-6-30-File-systems-New-and-revamped-file-systems-741319.html" target="_blank" rel="external">http://www.h-online.com/open/news/item/Kernel-Log-What-s-coming-in-2-6-30-File-systems-New-and-revamped-file-systems-741319.html</a></li>
</ol>
</div><div class="tags"><a href="/tags/Linux/">Linux</a></div><div class="post-nav"><a href="/2017/08/22/HTML标记/" class="next">HTML标记</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/日志/">日志</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/日志/二级目录/">二级目录</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hello/" style="font-size: 15px;">hello</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/26/文件time的意义/">文件time的意义</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/HTML标记/">HTML标记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/string类/">20行的string类（一行可以写完的代码为什么要写两行 +_+!）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/LInux文件与目录的权限/">Linux下目录和文件的权限</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/01/hello/">hello</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/jelly9" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">果冻.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>